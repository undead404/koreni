<!doctype html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Koreni Dashboard</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/@staticcms/app@^4.0.0/dist/main.css"
    />
  </head>
  <body>
    <script>
      // Listen for the token being written to LocalStorage by the callback tab
      window.addEventListener('storage', (event) => {
        if (event.key === 'static-cms-auth-bridge' && event.newValue) {
          console.log('Auth data detected in LocalStorage. Bridging to CMS...');

          const authData = event.newValue; // The string 'authorization:github:success:...'

          // Inject the handshake and the data exactly as the CMS expects
          window.postMessage('authorizing:github', window.location.origin);
          window.postMessage(authData, window.location.origin);

          // Clean up to prevent re-triggering on refresh
          localStorage.removeItem('static-cms-auth-bridge');
        }
      });
    </script>
    <script src="https://unpkg.com/@staticcms/app@^4.0.0/dist/static-cms-app.js"></script>
    <script>
      window.CMS.init();
    </script>
  </body>
</html>
