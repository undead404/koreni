<!doctype html>
<html lang="uk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Koreni Dashboard</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/@staticcms/app@^4.0.0/dist/main.css"
    />
  </head>
  <body>
    <script>
      const authChannel = new BroadcastChannel('static-cms-auth');

      authChannel.onmessage = (event) => {
        if (event.data.type === 'auth-success') {
          console.log('Auth message received via BroadcastChannel.');

          // Static CMS is very picky.
          // We must dispatch the event as if it came from the window it was expecting.
          const authEvent = new MessageEvent('message', {
            data: event.data.data,
            origin: window.location.origin,
            source: window, // Usually it expects the popup, but since the popup is gone, we try the window
          });

          // Dispatch "authorizing" handshake first
          window.dispatchEvent(
            new MessageEvent('message', {
              data: 'authorizing:github',
              origin: window.location.origin,
              source: window,
            }),
          );

          // Dispatch the actual success data
          window.dispatchEvent(authEvent);
        }
      };
    </script>
    <script src="https://unpkg.com/@staticcms/app@^4.0.0/dist/static-cms-app.js"></script>
    <script>
      window.CMS.init();
    </script>
  </body>
</html>
